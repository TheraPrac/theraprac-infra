# =============================================================================
# Dynamic AWS EC2 Inventory for Ziti Nonprod
# =============================================================================
# Uses the amazon.aws.aws_ec2 plugin to dynamically discover instances.
# Uses SSM Session Manager for connections (no SSH keys needed).
#
# Prerequisites:
#   - ansible-galaxy collection install amazon.aws
#   - pip install boto3 botocore
#   - Session Manager plugin installed
#   - AWS credentials configured (via env vars)
# =============================================================================

plugin: amazon.aws.aws_ec2

# AWS region to search
regions:
  - us-west-2

# Filter to only get our Ziti instance
filters:
  tag:Ansible: ziti-nonprod
  instance-state-name: running

# Use instance ID as the inventory hostname
hostnames:
  - instance-id

# Use SSM connection instead of SSH
compose:
  ansible_user: ec2-user
  ansible_connection: community.aws.aws_ssm
  ansible_aws_ssm_region: us-west-2

# Group instances by tags
keyed_groups:
  - key: tags.Ansible
    prefix: ansible
    separator: "_"
  - key: tags.Environment
    prefix: env
    separator: "_"
