# =============================================================================
# Inventory using EC2 Instance Connect Endpoint
# =============================================================================
# The ProxyCommand creates a tunnel to the private instance.
# Instance ID is read from ZITI_INSTANCE_ID environment variable.
# Set this via: export ZITI_INSTANCE_ID=$(terraform -chdir=../../infra/phase4-ziti output -raw ziti_ec2_id)
# =============================================================================

all:
  hosts:
    ziti-nonprod:
      # 127.0.0.1 is a placeholder - ProxyCommand handles actual routing
      ansible_host: 127.0.0.1
      ansible_port: 22
      ansible_user: ansible
      ansible_connection: ssh
      ansible_ssh_private_key_file: ~/.ssh/id_ed25519_ansible_1
      ansible_ssh_common_args: '-o ProxyCommand="aws ec2-instance-connect open-tunnel --instance-id {{ lookup(''env'', ''ZITI_INSTANCE_ID'') }} --region us-west-2" -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'
