# =============================================================================
# Ziti Controller Configuration
# =============================================================================
# Managed by Ansible - DO NOT EDIT MANUALLY
# =============================================================================

v: 3

# Database
db: {{ ziti_controller_dir }}/ctrl.db

# Controller identity (PKI)
identity:
  cert: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/certs/{{ ziti_pki_server_name }}-server.cert
  server_cert: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/certs/{{ ziti_pki_server_name }}-server.cert
  key: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/keys/{{ ziti_pki_server_name }}-server.key
  ca: {{ ziti_pki_dir }}/{{ ziti_pki_ca_name }}/certs/{{ ziti_pki_ca_name }}.cert

# Control plane listener (for routers)
ctrl:
  listener: tls:127.0.0.1:6262
  options:
    advertiseAddress: tls:{{ ziti_private_dns_name }}:6262

# Health checks
healthChecks:
  boltCheck:
    interval: 30s
    timeout: 20s
    initialDelay: 30s

# Edge configuration
edge:
  # API configuration (required for edge init)
  api:
    activityUpdateInterval: 90s
    activityUpdateBatchSize: 250
    sessionTimeout: 30m
    address: {{ ziti_public_endpoint }}:443
  # Enrollment configuration
  enrollment:
    signingCert:
      cert: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/certs/{{ ziti_pki_intermediate_name }}.cert
      key: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/keys/{{ ziti_pki_intermediate_name }}.key
    edgeIdentity:
      duration: 180m
    edgeRouter:
      duration: 180m

# Web API listeners
web:
  - name: client-management
    bindPoints:
      - interface: {{ ziti_controller_host }}:{{ ziti_controller_port }}
        address: {{ ziti_public_endpoint }}:443
    identity:
      cert: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/certs/{{ ziti_pki_server_name }}-server.cert
      server_cert: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/certs/{{ ziti_pki_server_name }}-server.cert
      key: {{ ziti_pki_dir }}/{{ ziti_pki_intermediate_name }}/keys/{{ ziti_pki_server_name }}-server.key
      ca: {{ ziti_pki_dir }}/{{ ziti_pki_ca_name }}/certs/{{ ziti_pki_ca_name }}.cert
    options:
      idleTimeout: 5000ms
      readTimeout: 5000ms
      writeTimeout: 100000ms
      minTLSVersion: TLS1.2
      maxTLSVersion: TLS1.3
    apis:
      - binding: edge-management
        options: {}
      - binding: edge-client
        options: {}
      - binding: fabric
        options: {}
