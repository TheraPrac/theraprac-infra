# =============================================================================
# Ziti Router Configuration
# =============================================================================
# Managed by Ansible - DO NOT EDIT MANUALLY
# Template: router.yaml.j2
#
# Note: The identity section is populated during enrollment.
# The router.cert, router.key, router.server.cert, and ca-chain.cert
# are generated by `ziti router enroll`.
# =============================================================================

v: 3

# Router identity (populated by enrollment process)
identity:
  cert: {{ ziti_router_dir }}/router.cert
  server_cert: {{ ziti_router_dir }}/router.server.cert
  key: {{ ziti_router_dir }}/router.key
  ca: {{ ziti_router_dir }}/ca-chain.cert

# CSR configuration for certificate generation during enrollment
edge:
  csr:
    country: {{ ziti_pki_country }}
    province: {{ ziti_pki_province }}
    locality: {{ ziti_pki_locality }}
    organization: {{ ziti_pki_org }}
    organizationalUnit: {{ ziti_pki_org_unit }}
    sans:
      dns:
        - localhost
        - {{ ziti_public_endpoint }}
      ip:
        - 127.0.0.1

# Connection to controller
ctrl:
  endpoint: tls:{{ ziti_public_endpoint }}:{{ ziti_controller_port }}

# Link dialer for router-to-router communication
link:
  dialers:
    - binding: transport

# Listeners
listeners:
  # Edge listener for SDK connections
  - binding: edge
    address: tls:0.0.0.0:{{ ziti_router_edge_port }}
    options:
      advertise: {{ ziti_public_endpoint }}:{{ ziti_router_edge_port }}
      connectTimeoutMs: 5000
      getSessionTimeout: 60s

  # Tunnel binding for hosting services
  - binding: tunnel
    options:
      mode: host

# Forwarder configuration
forwarder:
  latencyProbeInterval: 10s
  xgressDialQueueLength: 1000
  xgressDialWorkerCount: 128
  linkDialQueueLength: 1000
  linkDialWorkerCount: 32
