# =============================================================================
# TheraPrac Web - Systemd Service Unit
# =============================================================================
# Auto-generated by Ansible - DO NOT EDIT MANUALLY
# Generated: {{ ansible_date_time.iso8601 }}
# Environment: {{ target_env }}
# =============================================================================

[Unit]
Description=TheraPrac Web Application (Next.js Standalone)
Documentation=https://github.com/your-org/theraprac-web
After=network.target
Wants=network.target

[Service]
Type=simple
User={{ theraprac_user }}
Group={{ theraprac_group }}

# Working directory is the standalone output
WorkingDirectory={{ theraprac_web_dir }}

# Run the standalone server
# Node.js path determined by Ansible (typically /usr/bin/node after nodesource install)
ExecStart={{ node_path | default('/usr/bin/node') }} server.js

# Environment
Environment="NODE_ENV={{ node_env }}"
Environment="PORT={{ web_port }}"
Environment="HOSTNAME={{ web_hostname }}"

# Build metadata (from deployment)
Environment="BUILD_VERSION={{ actual_version }}"
Environment="BUILD_COMMIT={{ build_commit }}"
Environment="BUILD_BRANCH={{ build_branch }}"

# Process management
Restart=always
RestartSec=5

# Security hardening
NoNewPrivileges=yes
ProtectSystem=strict
ProtectHome=yes
PrivateTmp=yes
ReadWritePaths={{ theraprac_log_dir }}
ReadOnlyPaths={{ theraprac_web_dir }}

# Resource limits
MemoryMax=1G
TasksMax=100

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier={{ service_name }}

[Install]
WantedBy=multi-user.target

