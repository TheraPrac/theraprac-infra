# =============================================================================
# Inventory for Basic Server via EC2 Instance Connect
# =============================================================================
# Connects to the basic server (not Ziti controller) via EICE.
# Instance ID is dynamically retrieved from Terraform output.
#
# Usage: ansible-playbook -i inventory/server-eice.yml playbook.yml
# =============================================================================

all:
  hosts:
    basic-server:
      ansible_host: 127.0.0.1
      ansible_port: 22
      ansible_user: ansible
      ansible_connection: ssh
      ansible_ssh_private_key_file: ~/.ssh/id_ed25519_ansible_1
      # Instance ID is retrieved dynamically from Terraform
      ansible_ssh_common_args: >-
        -o ProxyCommand="aws ec2-instance-connect open-tunnel 
        --instance-id $(terraform -chdir=../../infra/phase7-basic-server output -raw instance_id) 
        --region us-west-2"
        -o StrictHostKeyChecking=no
        -o UserKnownHostsFile=/dev/null


