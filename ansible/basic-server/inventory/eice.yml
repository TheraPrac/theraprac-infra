# =============================================================================
# Inventory using EC2 Instance Connect Endpoint
# =============================================================================
# Fallback inventory when Ziti tunnel is not available.
# Uses EICE ProxyCommand to connect to private instances.
# =============================================================================

all:
  hosts:
    ziti-nonprod:
      ansible_host: 127.0.0.1
      ansible_port: 22
      ansible_user: ansible
      ansible_connection: ssh
      ansible_ssh_private_key_file: ~/.ssh/id_ed25519_ansible_1
      # Instance ID is retrieved dynamically from Terraform
      ansible_ssh_common_args: >-
        -o ProxyCommand="aws ec2-instance-connect open-tunnel 
        --instance-id $(terraform -chdir=../../infra/phase4-ziti output -raw ziti_ec2_id) 
        --region us-west-2"
        -o StrictHostKeyChecking=no
        -o UserKnownHostsFile=/dev/null

